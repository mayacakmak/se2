<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />

<script src="http://static.robotwebtools.org/threejs/current/three.min.js"></script>
<script src="https://static.robotwebtools.org/ros3djs/0.18.0/ColladaLoader.js"></script>
<!-- <script src="http://static.robotwebtools.org/threejs/current/ColladaLoader.min.js"></script> -->
<script src="js/ColladaLoader2.min.js"></script>
<!-- <script src="http://static.robotwebtools.org/ColladaAnimationCompress/current/ColladaLoader2.min.js"></script> -->
<script src="js/STLLoader.min.js"></script>
<!-- <script src="http://static.robotwebtools.org/threejs/current/STLLoader.min.js"></script> -->
<script src="http://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
<script src="http://static.robotwebtools.org/roslibjs/current/roslib.js"></script>
<script src="http://static.robotwebtools.org/ros3djs/current/ros3d.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js" integrity="sha256-bQmrZe4yPnQrLTY+1gYylfNMBuGfnT/HKsCGX+9Xuqo=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
</head>

<body onload="init()">
  <h1>Simple URDF Example</h1>
  <div id="urdf"></div>
  <script>
    /**
     * Setup all visualization elements when the page is loaded.
     */
    function init(ws_port) {
      // Connect to ROS.
      var ros = new ROSLIB.Ros({
        url : 'ws://localhost:'+String(ws_port)
      });
  
      // Create the main viewer.
      var viewer = new ROS3D.Viewer({
        divID : 'urdf',
        width : 800,
        height : 600,
        antialias : true
      });
  
      // Add a grid.
      viewer.addObject(new ROS3D.Grid());
  
      // Setup a client to listen to TFs.
      var tfClient = new ROSLIB.TFClient({
        ros : ros,
        angularThres : 0.01,
        transThres : 0.01,
        rate : 10.0
      });
  
      // Setup the URDF client.
      var urdfClient = new ROS3D.UrdfClient({
        ros : ros,
        tfClient : tfClient,
        //path : 'http://resources.robotwebtools.org/',
        path : '',
        rootObject : viewer.scene,
        loader : ROS3D.COLLADA_LOADER_2
      });
    }
  </script>
  <script>
    $(document).ready(function(){
        var socket = io.connect('http://' + document.domain + ':' + location.port + '/test');
        socket.on('start_visualization', function (message) {
            console.log(`Starting visualization on port `, message.port);
            init(message.port);
        });
    });
</script>
</body>
</html>